<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–≤—å—é</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col justify-center items-center bg-[#2B2D33] min-h-screen font-sans">
    <div class="bg-white shadow mt-6 p-6 rounded w-full max-w-4xl">
        <div class="bg-gray-50 mb-4 p-2 rounded">
            <h2 class="mb-2 font-semibold text-lg">–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é</h2>
            <div class="flex gap-4">
                <div class="flex-1">
                    <p class="font-medium text-gray-700 text-sm">–ü—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:</p>
                    <p id="personaDisplay" class="mt-1 text-sm">{{ persona if persona else "Not specified" }}</p>
                </div>
                <div class="flex-1">
                    <p class="font-medium text-gray-700 text-sm">–û—Ü–µ–Ω–∏–≤–∞–µ–º—ã–π –Ω–∞–≤—ã–∫:</p>
                    <p id="skillDisplay" class="mt-1 text-sm">{{ skill if skill else "Not specified" }}</p>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
        <div id="connection-status" class="bg-yellow-100 mb-2 p-2 rounded text-yellow-700 text-center">
            –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
        </div>
        
        <div id="messages" class="mb-4 p-4 border h-80 overflow-y-auto"></div>
        <form id="chat-form" onsubmit="sendMessage(event)" class="flex space-x-2">
            <input type="text" id="messageText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" class="flex-grow p-2 border rounded" disabled>
            <button type="submit" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded text-white" disabled>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </form>
        <div class="flex justify-between space-x-2 mt-4">
            <button id="endInterviewBtn" onclick="endInterview()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-white">
                –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤—å—é
            </button>
            <span id="recordingStatus" class="text-gray-600"></span>
            <button id="recordButton" onclick="toggleRecording()" class="bg-blue-600 hover:bg-red-600 px-4 py-2 rounded text-white" disabled>
                –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å
            </button>
        </div>
    </div>
    
    <script>
    // --- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–Ω—Ç–µ—Ä–≤—å—é –∏–∑ URL ---
    const urlParams = new URLSearchParams(window.location.search);
    const currentPersona = urlParams.get('persona');
    const currentSkill = urlParams.get('skill');

    // –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è
    if (!currentPersona || !currentSkill) {
        window.location.href = '/select-persona';
    }

    // --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ---
    document.getElementById('personaDisplay').textContent = currentPersona;
    document.getElementById('skillDisplay').textContent = currentSkill;

    // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É–¥–∏–æ, —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—Ä–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π ---
    let mediaRecorder; // –æ–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ
    let audioChunks = []; // –º–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
    let isRecording = false; // —Ñ–ª–∞–≥ –∑–∞–ø–∏—Å–∏
    let isConnected = false; // —Ñ–ª–∞–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
    let isWaitingForResponse = false; // —Ñ–ª–∞–≥ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    let ws; // WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

    // --- –ò—Å—Ç–æ—Ä–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ ---
    const conversationHistory = {
        timestamp: new Date().toISOString(),
        persona: currentPersona,
        skill: currentSkill,
        messages: []
    };

    // --- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ –∞—É–¥–∏–æ ---
    function connectWebSocket() {
        let wsHost = window.location.host;
        if (!wsHost || wsHost === 'false') wsHost = 'localhost:8000';
        const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
        const wsUrl = `${wsProtocol}://${wsHost}/ws/interview?persona=${encodeURIComponent(currentPersona)}&skill=${encodeURIComponent(currentSkill)}`;
        ws = new WebSocket(wsUrl);
        updateConnectionStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'yellow');
        ws.onopen = () => {
            isConnected = true;
            updateConnectionStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ', 'green');
            enableInterface();
        };
        ws.onclose = (event) => {
            isConnected = false;
            disableInterface();
            if (event.code === 1000) {
                updateConnectionStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ', 'yellow');
            } else {
                updateConnectionStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ', 'red');
                showError('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.');
            }
        };
        ws.onerror = (error) => {
            updateConnectionStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'red');
        };
        ws.onmessage = handleWebSocketMessage;
    }

    // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (—Ç–µ–∫—Å—Ç/–∞—É–¥–∏–æ/–æ—à–∏–±–∫–∏) ---
    function handleWebSocketMessage(event) {
        try {
            const response = JSON.parse(event.data);
            if (response.type === 'error') {
                showError(`–û—à–∏–±–∫–∞: ${response.text}`);
                resetWaitingState();
                return;
            }
            if (['text', 'voice'].includes(response.type)) {
                processMessage(response);
                updateChatDisplay();
                hideStatusMessage();
                resetWaitingState();
            }
        } catch {
            showError('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            resetWaitingState();
        }
    }

    // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏—é, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ ---
    function processMessage(response) {
        if (response.type === 'voice' && response.user_text) addUserMessage(response.user_text);
        if (response.content && response.content.trim()) {
            addAssistantMessage(response.content);
            if (response.type === 'voice' && response.audio) {
                hideStatusMessage();
                playAudio(response.audio);
            }
        }
    }

    // --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é ---
    function addUserMessage(content) {
        const lastUserMessage = getLastMessageByRole('user');
        if (!lastUserMessage || lastUserMessage.content !== content) {
            conversationHistory.messages.push({ role: "user", content });
        }
    }
    function addAssistantMessage(content) {
        const lastAssistantMessage = getLastMessageByRole('assistant');
        if (!lastAssistantMessage || lastAssistantMessage.content !== content) {
            conversationHistory.messages.push({ role: "assistant", content });
        }
    }
    function getLastMessageByRole(role) {
        return conversationHistory.messages.filter(msg => msg.role === role).pop();
    }
    function resetWaitingState() {
        isWaitingForResponse = false;
        enableInterface();
    }
    function hideStatusMessage() {
        updateConnectionStatus('', '');
    }

    // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ---
    function updateChatDisplay() {
        const messagesEl = document.getElementById('messages');
        messagesEl.innerHTML = "";
        conversationHistory.messages.forEach(msg => {
            const div = document.createElement('div');
            if (msg.role === 'user') {
                div.textContent = 'Ôºªüë§ÔºΩ: ' + msg.content;
                div.className = 'mb-2 text-right';
            } else if (msg.role === 'assistant') {
                div.textContent = 'Ôºªü§ñÔºΩ: ' + msg.content;
                div.className = 'mb-2 text-left';
            }
            messagesEl.appendChild(div);
        });
        scrollChatToBottom();
    }
    function scrollChatToBottom() {
        const messagesEl = document.getElementById('messages');
        messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function showError(message) {
        const statusElement = document.getElementById('connection-status');
        statusElement.textContent = message;
        statusElement.className = 'mb-2 p-2 text-center rounded bg-red-100 text-red-700';
        statusElement.classList.remove('hidden');
    }

    // --- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä ---
    function sendMessage(event) {
        event.preventDefault();
        if (!isConnected || isWaitingForResponse) return;
        const input = document.getElementById("messageText");
        const userMsg = input.value.trim();
        if (userMsg === "") return;
        addUserMessage(userMsg);
        updateChatDisplay();
        try {
            ws.send(JSON.stringify({ type: "text", message: userMsg }));
            input.value = '';
            isWaitingForResponse = true;
            disableInterface(true);
        } catch {
            showError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
        }
    }

    // --- –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ-–æ—Ç–≤–µ—Ç–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ ---
    function playAudio(base64Audio) {
        if (!base64Audio) return;
        try {
            const audio = new Audio();
            audio.src = 'data:audio/mp3;base64,' + base64Audio;
            setupAudioEventHandlers(audio);
            audio.play().catch(error => showError('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ: ' + error.message));
        } catch (error) {
            showError('–û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∞—É–¥–∏–æ: ' + error.message);
        }
    }
    function setupAudioEventHandlers(audio) {
        audio.onplay = () => {};
        audio.onended = () => {};
        audio.onerror = () => showError('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ');
    }

    // --- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤—å—é, —ç–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤ —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é ---
    function endInterview() {
        if (!conversationHistory.messages.length) {
            alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤—å—é –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.");
            return;
        }
        if (!confirm("–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤—å—é –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?")) return;
        try {
            exportInterviewData();
            closeConnection();
            redirectToHome();
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Ç–µ—Ä–≤—å—é: ' + error.message);
        }
    }
    function exportInterviewData() {
        const interviewData = {
            timestamp: new Date().toISOString(),
            persona: currentPersona,
            skill: currentSkill,
            messages: conversationHistory.messages,
        };
        if (!interviewData.messages.length) throw new Error("–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
        const jsonData = JSON.stringify(interviewData, null, 2);
        const blob = new Blob([jsonData], { type: 'application/json' });
        const fileName = generateFileName(currentPersona);
        downloadBlob(blob, fileName);
    }
    function generateFileName(persona) {
        const sanitizedPersona = persona.replace(/[^a-zA-Z–∞-—è–ê-–Ø0-9]/g, '_').substring(0, 20);
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        return `interview_${sanitizedPersona}_${timestamp}.json`;
    }
    function downloadBlob(blob, fileName) {
        const downloadLink = document.createElement('a');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = fileName;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
        URL.revokeObjectURL(downloadLink.href);
    }
    function closeConnection() {
        if (ws && ws.readyState === WebSocket.OPEN) ws.close(1000, "Interview completed");
    }
    function redirectToHome() {
        setTimeout(() => { window.location.href = "/"; }, 1000);
    }

    // --- –†–∞–±–æ—Ç–∞ —Å –∑–∞–ø–∏—Å—å—é –∏ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∞—É–¥–∏–æ (startRecording, stopRecording, processRecordedAudio –∏ –¥—Ä.) ---
    async function toggleRecording() {
        if (!isConnected || isWaitingForResponse) return;
        if (!isRecording) {
            startRecording();
        } else {
            stopRecording();
        }
    }
    async function startRecording() {
        const recordButton = document.getElementById('recordButton');
        const statusElement = document.getElementById('recordingStatus');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            setupRecordingHandlers();
            mediaRecorder.start();
            isRecording = true;
            updateRecordingUI(true);
        } catch {
            statusElement.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É';
            showError('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
        }
    }
    function stopRecording() {
        mediaRecorder.stop();
        isRecording = false;
        updateRecordingUI(false);
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
    }
    function setupRecordingHandlers() {
        mediaRecorder.ondataavailable = (event) => { audioChunks.push(event.data); };
        mediaRecorder.onstop = () => { processRecordedAudio(); };
    }
    async function processRecordedAudio() {
        try {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            convertBlobToBase64(audioBlob, sendAudioToServer);
        } catch {
            showError('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ');
        }
    }
    function convertBlobToBase64(blob, callback) {
        const reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = () => {
            const base64Audio = reader.result.split(',')[1];
            callback(base64Audio);
        };
    }
    function sendAudioToServer(base64Audio) {
        const payload = JSON.stringify({
            type: "audio",
            audio: base64Audio,
            format: 'webm'
        });
        try {
            ws.send(payload);
            updateConnectionStatus('–ê—É–¥–∏–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞...', 'yellow');
            isWaitingForResponse = true;
            disableInterface(true);
        } catch {
            showError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞—É–¥–∏–æ');
        }
    }
    function updateRecordingUI(isRecordingActive) {
        const recordButton = document.getElementById('recordButton');
        const statusElement = document.getElementById('recordingStatus');
        if (isRecordingActive) {
            recordButton.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
            recordButton.classList.add('bg-red-600');
            recordButton.classList.remove('bg-blue-600');
            statusElement.textContent = '–ó–∞–ø–∏—Å—å...';
            document.getElementById('messageText').disabled = true;
            document.querySelector('#chat-form button[type="submit"]').disabled = true;
        } else {
            recordButton.textContent = '–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å';
            recordButton.classList.remove('bg-red-600');
            recordButton.classList.add('bg-blue-600');
            statusElement.textContent = '';
        }
    }

    // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ ---
    function updateConnectionStatus(message, color) {
        const statusElement = document.getElementById('connection-status');
        if (!message) {
            statusElement.classList.add('hidden');
            return;
        }
        statusElement.textContent = message;
        statusElement.className = 'mb-2 p-2 text-center rounded';
        statusElement.classList.remove('hidden');
        const colorClasses = {
            'green': ['bg-green-100', 'text-green-700'],
            'yellow': ['bg-yellow-100', 'text-yellow-700'],
            'red': ['bg-red-100', 'text-red-700']
        };
        if (colorClasses[color]) {
            statusElement.classList.add(...colorClasses[color]);
            if (color === 'green') {
                setTimeout(() => statusElement.classList.add('hidden'), 2000);
            }
        }
    }
    function enableInterface() { setInterfaceState(false); }
    function disableInterface(waitingMode = false) { setInterfaceState(true, waitingMode); }
    function setInterfaceState(disabled, waitingMode = false) {
        const elements = [
            document.getElementById('messageText'),
            document.querySelector('#chat-form button[type="submit"]'),
            document.getElementById('recordButton')
        ];
        elements.forEach(el => { if (el) el.disabled = disabled; });
        if (!disabled) document.getElementById('messageText').focus();
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
    connectWebSocket();
    </script>
</body>
</html>